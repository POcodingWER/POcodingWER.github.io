---
layout: post
title: "[Npm] Npm package version Management"

subtitle: "프로젝트 package.json 버전을 관리해 보자"

date: 2024-09-09 10:35:00
# lastmod: 2024-08-14 10:10:00
author: "lim.Chuck"

# header-style: text

catalog: true
header-mask: 0.4
header-img: "img/post/2024/0909/yarn-vs-npm-vs-pnpm.png"
#
# sitemap:
#   changefreq: daily #스크랩 주기  daily | weekly | monthly
#   priority: 1.0  # 스크랩 우선순위
# hidden: true
categories:
  - Npm version
tags:
  - project management
  - npm vs yarn vs pnpm
---

> yarn 사용하는중인데 pnpm 도입을 한다고하여 비교분석해봄  
> [《 PNPM 》](https://pnpm.io/) 참고

## 비교

npm, yarn, pnpm은 모두 JavaScript 패키지 관리자로, 프로젝트에 필요한 라이브러리와 의존성을 설치하고 관리하는 도구입니다. 각 패키지 관리자는 성능, 기능, 사용성 측면에서 차이가 있다. 세 가지를 비교하고 분석해 보겠습니다.

### 1. **npm (Node Package Manager)**

- **특징**:

  - Node.js와 함께 기본으로 제공되는 패키지 관리자입니다.
  - CLI(Command Line Interface)가 직관적이며 사용하기 쉽다.
  - **package-lock.json** 파일을 사용하여 의존성 트리의 일관성을 보장합니다.
  - 2010년에 출시된 오래된 도구로, 커뮤니티 지원이 매우 활발합니다.

- **장점**:

  - Node.js와 함께 기본 제공되기 때문에 별도의 설치가 필요 없습니다.
  - 오랜 기간 사용되어 안정적이고, 많은 사용자가 있어 정보와 지원을 찾기 쉽다.
  - npm audit 명령어를 통해 보안 취약점을 쉽게 확인할 수 있다.

- **단점**:
  - 의존성 설치 속도가 다소 느리며, 대규모 프로젝트에서는 성능이 떨어질 수 있다.
  - 예전에는 종속성 중복 문제로 인해 **node_modules** 디렉토리가 비대해지는 문제가 있었습니다(최근에는 개선됨).

### 2. **Yarn**

- **특징**:

  - Facebook(현 Meta)에서 npm의 단점을 보완하기 위해 2016년에 출시한 패키지 관리자입니다.
  - 병렬 설치를 지원해 npm보다 빠른 속도를 자랑합니다.
  - 의존성 트리를 **yarn.lock** 파일을 통해 엄격히 관리하여 일관성을 보장합니다.
  - `yarn workspaces`를 통해 모노레포(mono-repo) 구조에서 패키지 관리를 쉽게 할 수 있다.

- **장점**:

  - 병렬 설치로 인해 npm보다 빠른 패키지 설치 속도를 제공합니다.
  - 캐시 기능이 뛰어나 네트워크 연결이 끊기더라도 재설치 없이 사용 가능합니다.
  - 모노레포 프로젝트에서 패키지 관리가 편리합니다.
  - 안전하고 일관된 빌드를 보장합니다.

- **단점**:
  - npm과 비교했을 때 초기 설정이 복잡할 수 있다.
  - 프로젝트에 따라선 사용하지 않는 추가적인 기능이 포함될 수 있다.

### 3. **pnpm**

- **특징**:

  - npm과 Yarn의 단점을 개선하여 2017년에 출시된 패키지 관리자입니다.
  - **하드 링크** 방식을 사용하여 동일한 의존성을 한 번만 설치하고, 여러 프로젝트에서 공유하여 사용하는 것이 특징입니다.
  - 패키지를 매우 효율적으로 설치하여 **node_modules** 디렉토리의 크기가 작고, 설치 속도도 빠릅니다.

- **장점**:

  - 하드 링크 방식 덕분에 동일한 패키지가 여러 프로젝트에서 재사용되므로 디스크 공간 절약이 큽니다.
  - 매우 빠른 패키지 설치 속도.
  - 모노레포 프로젝트에서도 효율적으로 관리할 수 있는 기능을 제공합니다.
  - **shrinkwrap.yaml** 파일을 통해 일관성을 보장합니다.

- **단점**:
  - 상대적으로 새로운 도구이기 때문에 npm이나 Yarn에 비해 생태계가 작고 정보가 부족할 수 있다.
  - 일부 도구와의 호환성 문제 발생 가능성.

### **최종 비교**

| **패키지 관리자** | **장점**                                 | **단점**                             | **추천 사용 경우**                       |
| ----------------- | ---------------------------------------- | ------------------------------------ | ---------------------------------------- |
| **npm**           | 기본 제공, 안정성, 커뮤니티 활발         | 다소 느린 속도                       | 기본적인 패키지 관리가 필요한 경우       |
| **Yarn**          | 빠른 설치 속도, 캐시 기능, 모노레포 지원 | 초기 설정 복잡                       | 성능이 중요한 대규모 프로젝트나 모노레포 |
| **pnpm**          | 디스크 공간 절약, 빠른 설치, 효율성      | 생태계가 아직 작음, 호환성 이슈 가능 | 디스크 효율성과 속도가 중요한 경우       |

따라서, **기본적인 프로젝트**에는 npm이 충분히 유용하며, **속도**나 **모노레포** 관리가 중요한 대규모 프로젝트에는 Yarn이나 pnpm을 고려해볼 수 있다. 특히, **pnpm**은 디스크 공간과 성능 측면에서 매우 우수한 선택이 될 수 있다.

## 보안

패키지 관리자의 **보안**은 개발 프로젝트에서 매우 중요한 요소입니다. 특히, 오픈소스 라이브러리나 패키지를 사용할 때는 의도치 않은 보안 취약점이나 악의적인 코드가 포함될 수 있기 때문에, 각 패키지 관리자가 보안에 어떻게 대응하고 있는지 이해하는 것이 필요합니다. npm, Yarn, pnpm의 보안 관련 기능을 각각 분석해보겠습니다.

### 1. **npm (Node Package Manager)**

- **보안 기능**:

  - **npm audit**: `npm audit` 명령어를 통해 설치된 패키지의 보안 취약점을 스캔하고, 해결할 방법을 제시합니다. 보안 취약점은 npm의 데이터베이스를 바탕으로 분석되며, 알려진 문제점을 즉시 알려줍니다.
  - **package-lock.json**: 이 파일은 설치된 패키지 버전을 고정하여 의존성 트리의 일관성을 보장합니다. 이를 통해 의도치 않게 악성 패키지나 취약한 버전이 설치되는 것을 방지할 수 있습니다.
  - **2FA (Two-Factor Authentication)**: npm 계정에는 이중 인증을 설정할 수 있어, 패키지 게시 시 계정 탈취로 인한 악성 패키지 업로드를 방지할 수 있습니다.
  - **npm 보안 업데이트**: npm은 보안 취약점이 발견된 패키지에 대해 자동으로 업데이트를 제공할 수 있도록 설정할 수 있습니다.

- **보안 관련 이슈**:
  - npm 레지스트리에 악성 패키지가 업로드된 사례가 있어, 이를 철저히 관리하지 않으면 보안 위협에 노출될 수 있습니다.
  - 의존성 트리가 복잡할 경우, 하위 의존성에서 취약점이 발생할 수 있어 철저한 관리가 필요합니다.

### 2. **Yarn**

- **보안 기능**:

  - **yarn audit**: npm audit과 유사하게, Yarn도 `yarn audit` 명령어를 통해 설치된 패키지의 보안 취약점을 분석할 수 있습니다. npm 레지스트리와 같은 보안 데이터베이스를 사용하여, 취약점을 빠르게 탐지하고 알려줍니다.
  - **yarn.lock**: 설치된 패키지 버전을 고정해, 일관된 의존성을 유지하며, 취약한 버전이 자동으로 업데이트되거나 다른 버전으로 대체되는 것을 방지합니다.
  - **보안 강화된 캐싱**: Yarn은 캐시 기능을 제공하나, 의도치 않은 취약한 패키지가 캐시에 저장되지 않도록 강화된 보안 체계를 갖추고 있습니다.
  - **Integrity Checks**: Yarn은 패키지 설치 시 해시값을 확인하여 패키지가 변조되지 않았는지 검사합니다.

- **보안 관련 이슈**:
  - npm과 동일한 레지스트리를 사용하기 때문에, 레지스트리에 등록된 패키지에 의존하는 한 npm에서 발생하는 보안 문제는 Yarn에서도 동일하게 발생할 수 있습니다.

### 3. **pnpm**

- **보안 기능**:

  - **pnpm audit**: pnpm도 `pnpm audit` 명령어를 사용해 보안 취약점을 검사할 수 있으며, npm의 취약점 데이터베이스를 기반으로 분석합니다.
  - **shrinkwrap.yaml**: pnpm은 이 파일을 통해 패키지 버전을 고정하고, 의존성을 일관성 있게 관리하여 불필요한 패키지 업데이트나 보안 취약점이 포함된 버전 설치를 방지합니다.
  - **Sandboxed Node Modules**: pnpm은 독특하게도 패키지를 심볼릭 링크로 연결하고, 각 프로젝트 간 의존성을 분리하여, 프로젝트 간 취약점 확산을 방지하는 추가 보안 계층을 제공합니다.
  - **Integrity Verification**: Yarn과 마찬가지로 패키지의 무결성을 검증하는 기능을 제공하여, 패키지가 중간에 변조되지 않았는지 확인합니다.

- **보안 관련 이슈**:
  - pnpm은 상대적으로 새로운 패키지 관리자이기 때문에, 보안 취약점이 발견되었을 때 대응이 npm이나 Yarn보다 늦을 수 있습니다.
  - npm 레지스트리를 사용하므로, 레지스트리 자체의 보안 문제는 여전히 적용됩니다.

### **보안 관련 최종 분석**

| **패키지 관리자** | **보안 기능**                                         | **보안 이슈**                                           |
| ----------------- | ----------------------------------------------------- | ------------------------------------------------------- |
| **npm**           | `npm audit`, 2FA, package-lock.json 지원              | 악성 패키지 업로드 가능성, 의존성 트리 취약점 관리 필요 |
| **Yarn**          | `yarn audit`, Integrity Check, yarn.lock              | npm과 동일한 레지스트리 사용으로 동일한 위험 발생 가능  |
| **pnpm**          | `pnpm audit`, Sandboxed Node Modules, shrinkwrap.yaml | 대응 속도가 npm보다 느릴 수 있음                        |

### **결론**

- **npm**은 보안 점검 도구가 잘 갖춰져 있어 기본적인 보안 관리가 용이하지만, 오픈 레지스트리의 특성상 악성 패키지가 업로드될 위험이 있습니다. 이중 인증(2FA)을 통해 계정 보안을 강화할 수 있으며, 보안 업데이트를 자동으로 처리하는 것이 유리합니다.
- **Yarn**은 npm과 비슷한 보안 기능을 제공하며, Integrity Check와 캐시 보안 등이 강화되어 있어 npm보다 조금 더 안전한 환경을 제공합니다.
- **pnpm**은 패키지를 분리된 공간에 설치하여 보안성을 높이지만, 아직 생태계가 작고 대응 속도가 npm이나 Yarn보다 느릴 수 있습니다. 특히, 프로젝트 간 패키지 격리 기능이 보안을 강화하는 요소로 작용할 수 있습니다.

보안을 중요한 요소로 고려할 경우, npm의 기본 제공 기능을 충분히 활용하거나, pnpm의 패키지 격리 방식을 선호할 수 있습니다.
